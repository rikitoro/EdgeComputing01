# エッジコンピューティング開発実習 1

## IoT 歩数計システムの開発

この実習では歩数計を IoT 化したシステムを構築します。

M5Stack (Gray) をウェアラブルな歩数計とみなし、利用者はこの歩数計を身に着けて利用します。
歩数計は M5Stack (Gray) に内蔵された加速度センサーにより利用者の歩行を検出し直近1分間の歩数をカウントします。

---

## システムの全体構成

<img src="./fig/system.png" alt="システムの全体構成">

---

## IoTデバイス側の要件

### 使用器材

| 器材 | 用途 |
|---|---|
|M5Stack| |
|Si7021| 気温測定のためのセンサー |

### IoTデバイスに求められる機能

1. ネットワークへの接続 : インターネットに接続された無線LAN アクセスポイントへWiFiにより接続して、実習用の Node-RED サーバへ HTTP 通信を行えるようにする。

1. 平均気温と最高気温の算出 : Si7021 センサーからおよそ 10 秒間隔で気温を取得する。この気温のデータから直近 1 分間の平均気温と最高気温を算出する。

2. 時刻の取得 : NTPプロトコルによりデバイス内部の時計を現在時刻に同期させ、時刻の取得ができるようにする。

3. 環境情報の送信 : およそ 1 分間隔で「環境情報」を実習用 Node-RED サーバに構築した データベースへ送信する。
ここで「環境情報」は以下の表で定義される。

| 項目 | 内容 |
|---|---|
| averageTemp | 直近 1 分間の平均気温 (実数値) |
| highestTemp | 直近 1 分間の最高気温 (実数値) |
| timestamp | データ送信時点の UNIX time (整数値) |

---

## クラウドサーバ側の要件

実習用に準備された Node-RED サーバを用いてシステムを構築します。

データベースマネージメントシステムとして Node-RED を事前にインストールしてください。




---

## 参考

- [M5Stack で現在時刻を取得する](./ntp_unixtime)
- [node-red にデータベースを構築する](./sqlite_on_nodered)



